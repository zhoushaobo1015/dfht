

<!doctype html>
<html lang="zh-cmn-Hans">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="./static/img/dfht_favicon.ico"/>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="./static/css/bootstrap-4.3.1.min.css">
    <link rel="stylesheet" href="./static/css/fontawesome-5.9.0.all.min.css">

    <!-- 单独引入 CSS -->
    <link rel="stylesheet" href="./static/css/style.css">
    <link rel="stylesheet" href="./static/css/bootstrap-datetimepicker.min.css">
    <link href="./static/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="./static/css/bootstrap-datepicker.css">

    <title>
        宏观择时【1】
    </title>
    
    <style>
        .nav-item {
            font-size: 36px;
            font-weight: bold;
        }
    </style>
    <style>
        /* Sidebar sizes when expanded and expanded */
        .sidebar-expanded {
            width: 150px;
        }

        .sidebar-collapsed {
            width: 60px;
        }

        #sidebar-container .list-group a {
            height: 50px;
            color: white;
        }

        /* Separators */
        .sidebar-separator-title {
            background-color: #333;
            height: 35px;
        }

        .sidebar-separator {
            background-color: #333;
            height: 25px;
        }

        #sidebar-container {
            min-height: 100%;
            background-color: #333;
            padding: 1px;
        }

        body {
            background: url("/static/img/bg01.jpg") center / cover no-repeat;
            min-height: 100vh;
        }

        .flex-grow {
            flex: 1;
        }
    </style>



</head>
<body class="d-flex flex-column">
<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="./static/js/jquery-3.4.1.min.js"></script>
<script src="./static/js/popper-1.14.7.min.js"></script>
<script src="./static/js/bootstrap-4.3.1.min.js"></script>


<header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark my-2">
        <a class="navbar-brand" href="/">
            <img src="./static/img/dfht-logo.png" alt="logo" width="auto" height="60px"
                 class="d-inline-block align-top">
            <a style="font-family: SimSun; font-size: 2em; color:white;"></a>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav  nav-fill w-100" id="topmenu">
                
    <li class="nav-item">
    <a class="nav-link" href="/dfht/macro/">宏观择时</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="/dfht/quant/">量化选股</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="/dfht/arbitrage/">对冲套利</a>
</li>

            </ul>
            <ul class="navbar-nav nav-fill">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                       data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="far fa-user"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right animate slideIn"
                         aria-labelledby="navbarDropdown">
                        
                            <a class="dropdown-item" href="/dfht/updatemacro/">指标更新</a>
                            <a class="dropdown-item" href="/dfht/updatesector/">板块定制</a>
                            <a class="dropdown-item" href="/dfht/updatesetting/">更新设置</a>
                        
                        
                            <a class="dropdown-item" href="/users/profiles/">用户管理</a>
                        
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/users/me/set">修改个人信息</a>
                        <a class="dropdown-item" href="/user_logout/">退出登录</a>
                    </div>
                </li>
                
    <li class="nav-item dropdown d-sm-block d-md-none" id="smallerscreenmenu">
        <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown"
           aria-haspopup="true" aria-expanded="false">模块菜单</a>
        <div class="dropdown-menu" aria-labelledby="smallerscreenmenu">
            
                <a class="dropdown-item" href="/dfht/macro/1">宏观指标</a>
            
                <a class="dropdown-item" href="/dfht/macro/2">市场趋势</a>
            
                <a class="dropdown-item" href="/dfht/macro/3">市场顶底</a>
            
                <a class="dropdown-item" href="/dfht/macro/4">市场估值</a>
            
        </div>
    </li><!-- Smaller devices menu END -->

            </ul>
        </div>
    </nav>
</header>


    <section class="container-fluid flex-grow">
        <div class="row" id="body-row">
            <div id="sidebar-container" class="sidebar-expanded d-none d-md-block">
                <ul class="list-group">
                    <a href="#" data-toggle="sidebar-colapse"
                       class="bg-dark list-group-item list-group-item-action d-flex align-items-center">
                        <div class="d-flex w-100 justify-content-start align-items-center">
                            <span id="collapse-icon" class="fa fa-angle-double-left fa-fw mr-3"></span>
                            <span id="collapse-text" class="menu-collapsed">收起菜单</span>
                        </div>
                    </a>
                    <li class="list-group-item sidebar-separator menu-collapsed"></li>
                    <li class="list-group-item sidebar-separator-title text-muted d-flex align-items-center menu-collapsed">
                        <small>宏观择时模块</small>
                    </li>
                    
                        <a href="/dfht/macro/1" class="bg-dark list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-start align-items-center">
                                <span class="fa fa-chart-pie mr-3"></span>
                                <span class="menu-collapsed">宏观指标</span>
                            </div>
                        </a>
                    
                        <a href="/dfht/macro/2" class="bg-dark list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-start align-items-center">
                                <span class="fas fa-signal mr-3"></span>
                                <span class="menu-collapsed">市场趋势</span>
                            </div>
                        </a>
                    
                        <a href="/dfht/macro/3" class="bg-dark list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-start align-items-center">
                                <span class="fas fa-chart-bar mr-3"></span>
                                <span class="menu-collapsed">市场顶底</span>
                            </div>
                        </a>
                    
                        <a href="/dfht/macro/4" class="bg-dark list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-start align-items-center">
                                <span class="fas fa-hand-holding-usd mr-3"></span>
                                <span class="menu-collapsed">市场估值</span>
                            </div>
                        </a>
                    
                </ul>
                <script>
                    // Collapse/Expand icon
                    // Collapse click
                    $('[data-toggle=sidebar-colapse]').click(function () {
                        $('.menu-collapsed').toggleClass('d-none');
                        $('.sidebar-submenu').toggleClass('d-none');
                        $('.submenu-icon').toggleClass('d-none');
                        $('#sidebar-container').toggleClass('sidebar-expanded sidebar-collapsed');
                        // Treating d-flex/d-none on separators with title
                        var SeparatorTitle = $('.sidebar-separator-title');
                        if (SeparatorTitle.hasClass('d-flex')) {
                            SeparatorTitle.removeClass('d-flex');
                        } else {
                            SeparatorTitle.addClass('d-flex');
                        }
                        // Collapse/Expand icon
                        $('#collapse-icon').toggleClass('fa-angle-double-left fa-angle-double-right');
                    });
                </script>
            </div>
            <div class="container col bg-light mx-3">
                <div class="top_wrap">
                    <div class="select_wrap">
                        <div class="ticket_selector_wrap">
                            <span>股票：</span>
                            <select class="selector">
                            </select>
                        </div>
                        <div class="segments_selector_wrap">
                            <span>板块：</span>
                            <select class="selector">
                            </select>
                        </div>
                    </div>
                    <button class="add_btn btn btn-primary">&nbsp;添加板块&nbsp;</button>
                </div>
                <div class="content_wrap">
                    <div class="ticket_detail_wrap hide">
                        <div class="left_wrap">
                            <div class="text_input_wrap code_wrap">
                                <span class="normal_font">代码</span>
                                <input class="code_input" type="text" />
                            </div>
                            <div class="text_input_wrap name_wrap">
                                <span class="normal_font">名称</span>
                                <input class="name_input" type="text" />
                            </div>
                            <div class="radio_text_wrap">
                                <span class="normal_font">是否ST</span>
                                <div class="radio_wrap">
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="isstOption" value="1">是
                                        </label>
                                    </div>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="isstOption" value="0">否
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="radio_text_wrap">
                                <span class="normal_font">是否中证</span>
                                <div class="radio_wrap">
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="iszzOption" value="1">是
                                        </label>
                                    </div>
                                    <div class="radio">
                                        <label>
                                            <input type="radio" name="iszzOption" value="0">否
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="text_input_wrap select_start_date_wrap select_date_wrap">
                                <span class="normal_font">开始时间</span>
                                <input class="main2_startdate page_datepicker" data-date-end-date="0d"/>
                            </div>
                            <div class="text_input_wrap select_end_date_wrap select_date_wrap">
                                <span class="normal_font">结束时间</span>
                                <input class="main2_enddate page_datepicker" data-date-end-date="0d"/>
                            </div>
                        </div>
                        <div class="center_wrap">
                            <span>所在的板块：</span>
                            <div class="selected_segments_wrap">
                                <ul class="list-group">
                                    <!-- <li class="list-group-item">Cras justo odio</li>
                                    <li class="list-group-item">Dapibus ac facilisis in</li>
                                    <li class="list-group-item">Vestibulum at eros</li> -->
                                </ul>
                            </div>
                        </div>
                        <div class="right_wrap">
                            <div class="add_wrap">
                                <span>《《（添加）</span>
                            </div>
                            <div class="selector_wrap segments_selector_wrap">
                                <select class="selectors"> </select>
                                <div class="btn_wrap">
                                    <button class="confirm_btn btn btn-primary">&nbsp;&nbsp;确定&nbsp;&nbsp;</button>
                                    <button class="cancel_btn btn btn-primary">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="add_segments_wrap hide">
                        <div class="left_wrap">
                            <div class="text_input_wrap code_wrap">
                                <span class="normal_font">代码</span>
                                <input class="code_input" type="text" />
                            </div>
                            <div class="text_input_wrap name_wrap">
                                <span class="normal_font">名称</span>
                                <input class="name_input" type="text" />
                            </div>
                            <div class="type_selector_wrap">
                                <span class="normal_font">类型</span>
                                <select class="selector">
                                    <option value="指数">指数</option>
                                    <option value="半自定义">半自定义</option>
                                    <option value="行业">行业</option>
                                    <option value="全自定义">全自定义</option>
                                </select>
                            </div>
                            <div class="text_input_wrap select_start_date_wrap select_date_wrap">
                                <span class="normal_font">开始时间</span>
                                <input class="main2_startdate page_datepicker" data-date-end-date="0d"/>
                            </div>
                            <div class="grouping_selector_wrap">
                                <span class="normal_font">分组</span>
                                <select class="selector">
                                    <option value="市场组">市场组</option>
                                    <option value="规模组">规模组</option>
                                    <option value="全指行业组">全指行业组</option>
                                    <option value="申万行业组">申万行业组</option>
                                    <option value="其它组">其它组</option>
                                </select>
                            </div>
                            <div class="text_input_wrap">
                                <span class="normal_font">附注</span>
                                <textarea class="notes" type="text"></textarea>
                            </div>
                        </div>
                        <div class="center_wrap">
                            <span>成分股列表：</span>
                            <div class="selected_cfg_wrap">
                                <ul class="list-group"></ul>
                            </div>
                        </div>
                        <div class="right_wrap">
                            <div class="add_wrap">
                                <span>《《（添加）</span>
                            </div>
                            <div class="selector_wrap ticket_selector_wrap">
                                <select class="selectors"></select>
                                <div class="btn_wrap">
                                    <button class="confirm_btn btn btn-primary">&nbsp;&nbsp;确定&nbsp;&nbsp;</button>
                                    <button class="cancel_btn btn btn-primary">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
<!-- 所有将要完成的内容全在这个容器内, 宽不动，高无限 -->

            <!-- 沙漏弹窗 -->
            <div class="modal fade" id="main2Hourglass" tabindex="-1" role="dialog" aria-labelledby="main1Hourglass" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-body">
                                <!-- 沙漏弹窗 content -->
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal -->
                </div>
            </div>
        </div>
    </section>
    <script>
        var pics = ["./static/img/bg_0.jpg", "./static/img/bg_1.jpg", "./static/img/bg_2.jpg"];
        $(document).ready(function () {
            $("#topmenu li").removeClass('active');
            $("#sidebar-container a").removeClass('active');
            $("#smallerscreenmenu a").removeClass('active');
            $("#topmenu li").eq(0).addClass('active');
            $("#sidebar-container a").eq(1).addClass('active');
            $("#smallerscreenmenu a").eq(1).addClass('active');
            $("body").css("background-image", "url(" + pics[0] + ")");
        });
    </script>


<footer class="bg-dark text-white mt-3">
    <div class="d-flex justify-content-between mx-2 ">
        <div></div>
        <div>© 2019:<a href="http://www.orientever.com/index.php">
            东方恒泰投资管理有限公司</a>
        </div>
    </div>
</footer>

</body>
<script src="./static/js/select2.min.js"></script>
<script src="./static/js/bootstrap-datepicker.js"></script>
<script src="./static/js/common.js"></script>

<script>
    $(function(){

        // 判断session中是否有内容如果没有请求数据 -->> 股票
        var sessionS = sessionStorage.getItem('myoptions');
        if(sessionS !== null && sessionS !== "undefined" ){
            let { ticket } = JSON.parse( sessionS );
            let select2Data = [...ticket];
            var frag = document.createDocumentFragment();
            if (select2Data.length > 0) {
                frag.append($('<option>请选择：</option>')[0]);
            }
            ticket.map(data => {
                frag.append($(`<option data-id=${data.id} val=${data.pinyin} data-pinyin=${data.pinyin}>${data.text}</option>`)[0])
            })
            $(`.ticket_selector_wrap .selector`).append(frag)
        }else {
            // let url = "/dfht/ajax_get_options"; //上线解开这个即可
            let url = './static/json/myoptions.json'; //上线需要删除
            $.get(url,function(result){
                let { macro } = result;
                // 存储到session
                sessionStorage.setItem("myoptions",JSON.stringify(result));
                let select2Data = [...macro];
                var frag = document.createDocumentFragment();
                if (select2Data.length > 0) {
                    frag.append($('<option>请选择：</option>')[0])
                }
                select2Data.map(data => {
                    frag.append($(`<option data-id=${data.id} value=${data.pinyin} data-pinyin=${data.pinyin}>${data.text}</option>`)[0])
                })
                $('#main1-select1').append(frag)
            });
        }

        
        // 判断session中是否有内容如果没有请求数据 -->> 版块
        var sessionS = sessionStorage.getItem('myoptions');
        if(sessionS !== null && sessionS !== "undefined" ){
            let { sector } = JSON.parse( sessionS );
            let sectorData = [...sector];

            var frag = document.createDocumentFragment();
            if (sectorData.length > 0) {
                frag.append($('<option>请选择：</option>')[0])
            }
            sectorData.map(data => {
                frag.append($(`<option data-id=${data.id} val=${data.pinyin} data-pinyin=${data.pinyin}>${data.text}</option>`)[0])
            })
            $(`.segments_selector_wrap .selector`).append(frag)
        }else {
            let url = "/dfht/ajax_get_options"; //上线解开这个即可
            $.get(url,function(result){
                let sector = result.sector;
                // 存储到session
                sessionStorage.setItem("myoptions",JSON.stringify(result));
                var frag = document.createDocumentFragment();
                if (sector.length > 0) {
                    frag.append($('<option>请选择：</option>')[0])
                }
                sector.map(data => {
                    frag.append($(`<option data-id=${data.id} val=${data.pinyin} data-pinyin=${data.pinyin}>${data.text}</option>`)[0])
                })
                $(`.segments_selector_wrap .selector`).append(frag)
            });
        }

        // main2-选择股票选项
        $('.top_wrap .ticket_selector_wrap .selector').on('select2:select', function(){
            $('.ticket_detail_wrap').removeClass('hide')
            $('.add_segments_wrap').addClass('hide')
            let checkedItem = $(this).find('option:checked')
            let id = checkedItem.data('id')
            let pinyin = checkedItem.data('pinyin')
            let text = checkedItem.text();
            
            // let url = "/dfht/ajax_get_target?id="+id //线上时候需要开启这里
            let url = "./static/json/sample_股票.json"

            $.get(url, function(result) {
                $('.ticket_detail_wrap .code_input').val(result.tcode)
                $('.ticket_detail_wrap .name_input').val(result.shortname)
                let isstIndex = result.is_st === 0 ? 1 : 0
                $('input:radio[name="isstOption"]').eq(isstIndex).attr('checked', 'checked')
                let iszzIndex = result.is_zz === 0 ? 1 : 0
                $('input:radio[name="iszzOption"]').eq(iszzIndex).attr('checked', 'checked')
                $('.ticket_detail_wrap .main2_startdate').datepicker('update', result.start_date);
                $('.main2_enddate').datepicker('update', result.end_date);
                $('.selected_segments_wrap ul').empty();
                let sector = result.groupbelong;
                var frag = document.createDocumentFragment();
                sector.map(data => {
                    frag.append($(`<option data-id=${data.id} val=${data.pinyin} data-pinyin=${data.pinyin}>${data.text}</option>`)[0])
                })
                $(`.segments_selector_wrap .selectors`).append(frag);
            });
        })


        // 选择板块选项
        $('.top_wrap .segments_selector_wrap .selector').on('select2:select', function() {
            $('.add_segments_wrap').removeClass('hide')
            $('.ticket_detail_wrap').addClass('hide')

            let checkedItem = $(this).find('option:checked')
            let id = checkedItem.data('id')
            let pinyin = checkedItem.data('pinyin')
            let text = checkedItem.text();
            // let url = "/dfht/ajax_get_target?id="+id //线上时候需要开启这里
            let url = "./static/json/sample_板块.json"
            $.get(url, function(result) {
                $('.add_segments_wrap .code_input').val(result.scode)
                $('.add_segments_wrap .name_input').val(result.shortname)
                $('.add_segments_wrap .main2_startdate').datepicker('update', result.startdate);
                $('.type_selector_wrap .selector').val(result.stype).select2()
                $('.add_segments_wrap .grouping_selector_wrap .selector').val(result.sec_group).select2()
                $('.add_segments_wrap .notes').val(result.notes)
                $('.add_segments_wrap ul').empty();
                
                let sector = result.memberlist;
                var frag = document.createDocumentFragment();
                sector.map(data => {
                    frag.append($(`<option data-id=${data.id} val=${data.pinyin} data-pinyin=${data.pinyin}>${data.text}</option>`)[0])
                })
                $(`.ticket_selector_wrap .selectors`).append(frag);

            });
        })

        // main2-输入股票代码后确定按钮点击事件
        $('.ticket_detail_wrap .segments_selector_wrap .confirm_btn').click(function() {
            let end_date = $('.main2_enddate').val()
            let start_date = $('.main2_startdate').val()
            let groupbelong = []
            $('.selected_segments_wrap ul').children().each((i, item) => {
                let id = $(item).data('id')
                let name = $(item).text()
                groupbelong.push([id, name])
            })
            let is_st = Number($('input:radio[name="isstOption"]:checked').val())
            let is_zz = Number($('input:radio[name="iszzOption"]:checked').val())
            let shortname = $('.content_wrap .left_wrap .name_input').val()
            let tcode = $('.ticket_detail_wrap .code_input').val()
            let data = {
                end_date,
                groupbelong,
                is_st,
                is_zz,
                shortname,
                start_date,
                tcode,
            }
            console.log('data', data,"main2 >>> 528行");

            $("#main2Hourglass").modal('toggle');
            $("#main2Hourglass .modal-body").html('<i class="fa fa-hourglass-start fa-spin fa-3x fa-fw margin-bottom"></i>');
            $.ajax({
                "url":"dfht/ajax_get_target",
                "type":"post",
                data: data,
                success: function(res){
                    if(res.status===200){
                        $("#main2Hourglass .modal-body").html('<div class="wrappers"><div><i class="fa fa-check" aria-hidden="true" style="margin-right:10px;"></i>提交成功</div></div>')
                    }else{
                        $("#main2Hourglass .modal-body").html('<div class="wrappers"><div><i class="fa fa-times" aria-hidden="true" style="margin-right:10px;"></i>提交失败</div></div>')
                    }
                },
                error: function(err){
                    $("#main2Hourglass .modal-body").html('<div class="wrappers"><div><i class="fa fa-times" aria-hidden="true" style="margin-right:10px;"></i>提交失败</div></div>')
                }
            })
        })


        // main2-输入板块代码后确定按钮点击事件
        $('.add_segments_wrap .ticket_selector_wrap .confirm_btn').click(function() {
            let notes = $('.add_segments_wrap .notes').val()
            let scode = $('.add_segments_wrap .code_input').val()
            let sec_group = $('.add_segments_wrap .grouping_selector_wrap .selector').val()
            let shortname = $('.add_segments_wrap .name_input').val()
            let startdate = $('.add_segments_wrap .main2_startdate').val();            
            let stype = $('.type_selector_wrap .selector').val()
            let memberlist = []
            $('.selected_cfg_wrap ul').children().each((i, item) => {
                let id = $(item).data('id')
                let name = $(item).text()
                memberlist.push([id, name])
            })
            let data = {
                memberlist,
                notes,
                scode,
                sec_group,
                shortname,
                startdate,
                stype
            }
            console.log('data', data,"main2 >>> 555行")


            $("#main2Hourglass").modal('toggle');
            $("#main2Hourglass .modal-body").html('<i class="fa fa-hourglass-start fa-spin fa-3x fa-fw margin-bottom"></i>');
            $.ajax({
                "url":"/dfht/ajax_get_target",
                "type":"post",
                data: data,
                success: function(res){
                    if(res.status===200){
                        $("#main2Hourglass .modal-body").html('<div class="wrappers"><div><i class="fa fa-check" aria-hidden="true" style="margin-right:10px;"></i>提交成功</div></div>')
                    }else{
                        $("#main2Hourglass .modal-body").html('<div class="wrappers"><div><i class="fa fa-times" aria-hidden="true" style="margin-right:10px;"></i>提交失败</div></div>')
                    }
                },
                error: function(err){
                    $("#main2Hourglass .modal-body").html('<div class="wrappers"><div><i class="fa fa-times" aria-hidden="true" style="margin-right:10px;"></i>提交失败</div></div>')
                }
            })


            
        })


    })

</script>
</html>